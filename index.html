<?php

$count = 0;
$orderPattern = "popular";
$cardimages = [
  "https://mdbootstrap.com/img/Photos/Horizontal/Work/4-col/img%20%2814%29.jpg",
  "https://toyokeizai.net/mwimgs/9/9/-/img_998fee1877ca9f2b6bacc06460085709898323.jpg",
  "https://careergarden.jp/shiyakushoshokuin/files/faf41507407698c0d3f259fde6941418.jpg",
  "https://image-select.mamastar.jp/interspace/wp-content/uploads/1593142317-3dc883354d19082fbb9070403454bcb6-1200x800.jpg",
  "https://job.dmkt-sp.jp/images/pages/article/work_quality_management_180807_01.jpg"
];

if(isset($_POST['new'])) {
  $USER = 'root';
  $PW = 'pass';
  $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
  $orderPattern = "new";

  try{
    $pdo = new PDO($dnsinfo,$USER,$PW);
    //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
    $sql = "SELECT * FROM internships ORDER BY PublicationDay DESC LIMIT 2;";
    $stmt = $pdo->prepare($sql);
    $stmt->execute(null);
    $res = "";
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
      //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";

      $cardimagenumber = array_rand($cardimages);
      $cardimage = $cardimages[$cardimagenumber];

      $res .=<<<_CARD
      <!-- Card -->
      <div class="card card-image mt-5"
        style="background-image: url({$cardimage});">

        <!-- Content -->
        <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
          <div>
            <h5 class="pink-text">{$row['Field']}</h5>
            <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
            <p>{$row['InternshipText'] }</p>
            <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
          </div>
        </div>

      </div>
      <!-- Card -->
      _CARD;

      //$res .= ."<br>\n";
    }
    $res .=<<<_BUTTON
    <form class="row pt-5" action="main.php#addinternship" method="post">
      <div class="col-md-4 col-2"></div>
      <button  class="btn btn-outline-primary btn-rounded waves-effect col-md-4 col-8" type="submit" name="addnew" value=2>もっと見る</button>
      <div class="col-md-4 col-2"></div>
    </form>
_BUTTON;

  }catch(PDOException $e){
    $res = $e->getMessage();
  }
}else if(isset($_POST['popular'])){
  $USER = 'root';
  $PW = 'pass';
  $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
  try{
    $pdo = new PDO($dnsinfo,$USER,$PW);
    //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
    $sql = "SELECT * FROM internships ORDER BY Popular DESC LIMIT 2;";
    $stmt = $pdo->prepare($sql);
    $stmt->execute(null);
    $res = "";
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
      //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";

      $cardimagenumber = array_rand($cardimages);
      $cardimage = $cardimages[$cardimagenumber];

      $res .=<<<_CARD
      <!-- Card -->
      <div class="card card-image mt-5"
        style="background-image: url({$cardimage});">

        <!-- Content -->
        <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
          <div>
            <h5 class="pink-text">{$row['Field']}</h5>
            <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
            <p>{$row['InternshipText'] }</p>
            <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
          </div>
        </div>

      </div>
      <!-- Card -->
      _CARD;

      //$res .= ."<br>\n";
    }
    $res .=<<<_BUTTON
    <form class="row pt-5" action="main.php#addinternship" method="post">
      <div class="col-md-4 col-2"></div>
      <button  class="btn btn-outline-primary btn-rounded waves-effect col-md-4 col-8" type="submit" name="add" value=2>もっと見る</button>
      <div class="col-md-4 col-2"></div>
    </form>
_BUTTON;
  }catch(PDOException $e){
    $res = $e->getMessage();
  }
}else if(isset($_POST['add'])){
  $USER = 'root';
  $PW = 'pass';
  $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
  $count = $_POST['add'];
  $count = $count + 1;

  try{
    if($orderPattern="popular"){
      $pdo = new PDO($dnsinfo,$USER,$PW);
      //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
      $sql = "SELECT * FROM internships ORDER BY Popular DESC LIMIT {$count};";
      $stmt = $pdo->prepare($sql);
      $stmt->execute(null);
      $res = "";
      $i = 0;
      while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
        //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";
        $cardimagenumber = array_rand($cardimages);
        $cardimage = $cardimages[$cardimagenumber];

        //追加したカードに飛ぶリンクをつけるためのアルゴリズム
        if ($i==($count-1)){
          $res .=<<<_CARD

          <a name="addinternship" class="pt-5"></a>


          <!-- Card -->
          <div class="card card-image mt-5"
            style="background-image: url({$cardimage});">

            <!-- Content -->
            <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
              <div>
                <h5 class="pink-text">{$row['Field']}</h5>
                <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
                <p>{$row['InternshipText'] }</p>
                <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
              </div>
            </div>

          </div>
          <!-- Card -->
          _CARD;
        }else{
          $res .=<<<_CARD
          <!-- Card -->
          <div class="card card-image mt-5"
            style="background-image: url($cardimage);">

            <!-- Content -->
            <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
              <div>
                <h5 class="pink-text">{$row['Field']}</h5>
                <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
                <p>{$row['InternshipText'] }</p>
                <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
              </div>
            </div>

          </div>
          <!-- Card -->
          _CARD;
        }

        $i = $i + 1;

        //$res .= ."<br>\n";
      }
      $res .=<<<_BUTTON
      <form class="row pt-5" action="main.php#addinternship" method="post">
        <div class="col-md-4 col-2"></div>
        <button  class="btn btn-outline-primary btn-rounded waves-effect col-md-4 col-8" type="submit" name="add" value={$count}>もっと見る</button>
        <div class="col-md-4 col-2"></div>
      </form>
  _BUTTON;
}}
catch(PDOException $e){
    $res = $e->getMessage();
}
}else if(isset($_POST['addnew'])){
      $USER = 'root';
      $PW = 'pass';
      $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
      $count = $_POST['addnew'];
      $count = $count + 1;

      try{
      $pdo = new PDO($dnsinfo,$USER,$PW);
      //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
      $sql = "SELECT * FROM internships ORDER BY PublicationDay DESC LIMIT {$count};";
      $stmt = $pdo->prepare($sql);
      $stmt->execute(null);
      $res = "";
      $i = 0;
      while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
        //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";
        $cardimagenumber = array_rand($cardimages);
        $cardimage = $cardimages[$cardimagenumber];

        //追加したカードに飛ぶリンクをつけるためのアルゴリズム
        if ($i==($count-1)){
          $res .=<<<_CARD

          <a name="addinternship" class="pt-5"></a>


          <!-- Card -->
          <div class="card card-image mt-5"
            style="background-image: url({$cardimage});">

            <!-- Content -->
            <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
              <div>
                <h5 class="pink-text">{$row['Field']}</h5>
                <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
                <p>{$row['InternshipText'] }</p>
                <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
              </div>
            </div>

          </div>
          <!-- Card -->
          _CARD;
        }else{


      $res .=<<<_CARD
      <!-- Card -->
      <div class="card card-image mt-5"
        style="background-image: url({$cardimage});">

        <!-- Content -->
        <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
          <div>
            <h5 class="pink-text">{$row['Field']}</h5>
            <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
            <p>{$row['InternshipText'] }</p>
            <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
          </div>
        </div>

      </div>
      <!-- Card -->
      _CARD;

    $i = $i + 1;
  }
    //$res .= ."<br>\n";
  }
  $res .=<<<_BUTTON
  <form class="row pt-5" action="main.php#addinternship" method="post">
    <div class="col-md-4 col-2"></div>
    <button  class="btn btn-outline-primary btn-rounded waves-effect col-md-4 col-8" type="submit" name="addnew" value={$count}>もっと見る</button>
    <div class="col-md-4 col-2"></div>
  </form>
_BUTTON;
}
catch(PDOException $e){
    $res = $e->getMessage();
  }
}else {
  $USER = 'root';
  $PW = 'pass';
  $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
  try{
    $pdo = new PDO($dnsinfo,$USER,$PW);
    //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
    $sql = "SELECT * FROM internships ORDER BY popular DESC LIMIT 2;";
    $stmt = $pdo->prepare($sql);
    $stmt->execute(null);
    $res = "";
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
      //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";

      $cardimagenumber = array_rand($cardimages);
      $cardimage = $cardimages[$cardimagenumber];

      $res .=<<<_CARD
      <!-- Card -->
      <div class="card card-image mt-5"
        style="background-image: url({$cardimage});">

        <!-- Content -->
        <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
          <div>
            <h5 class="pink-text">{$row['Field']}</h5>
            <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
            <p>{$row['InternshipText'] }</p>
            <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
          </div>
        </div>

      </div>
      <!-- Card -->
      _CARD;

      //$res .= ."<br>\n";
    }
    $res .= <<<_BUTTON
    <form class="row pt-5" action="main.php#addinternship" method="post">
      <div class="col-md-4 col-2"></div>
      <button  class="btn btn-outline-primary btn-rounded waves-effect col-md-4 col-8" type="submit" name="add" value=2>もっと見る</button>
      <div class="col-md-4 col-2"></div>
    </form>
_BUTTON;
  }catch(PDOException $e){
    $res = $e->getMessage();
  }
}


if(isset($_POST['fields']) && is_array($_POST['fields'])) {
  $USER = 'root';
  $PW = 'pass';
  $dnsinfo = "mysql:dbname=internshiptest;host=localhost;charset=utf8";
  $fieldvalue = $_POST['fields'];
  $fieldvaluelength = count($fieldvalue);
  try{
    $pdo = new PDO($dnsinfo,$USER,$PW);
    //$parameters = "?".str_repeat(",?", $fieldvaluelength-1);
    //echo $parameters;
    //echo $fieldvaluelength;

    //$sql = "INSERT INTO internships VALUES(4,'D','This is the card title','2020-3-7','https://www.bittorrent.com/ja/','Marketing','Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat fugiat, laboriosam, voluptatem, optio vero odio nam sit officia accusamus minus error nisi architecto nulla ipsum dignissimos. Odit sed qui, dolorum!.',2)";
    $res = "";
    $i2=0;
    foreach( $_POST['fields'] as $value){
      $sql = "SELECT * FROM internships WHERE Field='{$value}' ORDER BY PublicationDay DESC ;";
      $stmt = $pdo->prepare($sql);
      $stmt->execute(null);
      while ($row = $stmt->fetch(PDO::FETCH_ASSOC)){
        //$res .= $row['InternshipTitle'] ."," .$row['InternshipText'] ."," .$row['Field'] ."<br>\n";

        $cardimagenumber = array_rand($cardimages);
        $cardimage = $cardimages[$cardimagenumber];

        $res .=<<<_CARD
        <!-- Card -->
        <div class="card card-image mt-5"
          style="background-image: url({$cardimage});">

          <!-- Content -->
          <div class="text-white text-center d-flex align-items-center rgba-black-strong py-5 px-4">
            <div>
              <h5 class="pink-text">{$row['Field']}</h5>
              <h3 class="card-title pt-2"><strong></strong>{$row['InternshipTitle']}</h3>
              <p>{$row['InternshipText'] }</p>
              <a class="btn btn-pink"><i class="fas fa-clone left"></i>このインターンシップを見る</a>
            </div>
          </div>

        </div>
        <!-- Card -->
        _CARD;
        }

        //カードが一定以上の数になったら抜け出す
        $i2 = $i2+1;
        if ($i2==3){
          break;
      }
    }

    /*
    $res .=<<<_BUTTON
    <form class="row pt-5" action="main.php#addinternship" method="post">
      <div class="col-4"></div>
      <button  class="btn btn-outline-primary btn-rounded waves-effect col-4" type="submit" name="addpartially" value=1>もっと見る</button>
      <div class="col-4"></div>
    </form>
_BUTTON;
  */

  }catch(PDOException $e){
    $res = $e->getMessage();
  }
}


?>
